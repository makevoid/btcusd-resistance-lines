<html>
  <head>
    <script src="https://code.jquery.com/jquery-2.2.3.min.js" integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=" crossorigin="anonymous"></script>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>

  </head>

  <body>

    <div id="container" style="width:100%; height:800px;"></div>
    <script type="text/javascript">

      // TODO: Rewrite in React or in hyperhtml or HTML5 web component

      $(document).ready(function() {
          $.getJSON("http://localhost:3000/ticks/ticks.json", function(a) {
              $.getJSON("http://localhost:3000/ml_results.json", function(b) {
                  var c = [];
                  for (var d in a) {
                      ob = a[d];
                      c.push([ Date.parse(d), parseFloat(ob.open), parseFloat(ob.high), parseFloat(ob.low), parseFloat(ob.close) ]);
                  }
                  c = c.sort();
                  $("#container").highcharts("StockChart", {
                      chart: {
                          events: {
                              load: function() {
                                  for (i in b) this.yAxis[0].addPlotLine({
                                      value: b[i],
                                      width: 2,
                                      dashStyle: "shortdash",
                                      color: "red"
                                  });
                              }
                          }
                      },
                      rangeSelector: {
                          selected: 1
                      },
                      title: {
                          text: ""
                      },
                      yAxis: {
                          title: {
                              text: "Exchange rate"
                          },
                          type: "logarithmic",
                          plotLines: []
                      },
                      series: [ {
                          type: "candlestick",
                          name: "Price",
                          data: c,
                          tooltip: {
                              valueDecimals: 2
                          }
                      } ]
                  });
              });
          });
      });


    </script>
  </body>


</html>
